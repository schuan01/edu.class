<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>Editar usuario|Edu.Class</title>

    <link rel="shortcut icon" href="Content/images/logo.ico" type="image/x-icon" />
    <link rel="icon" href="Content/images/logo.ico" type="image/ico" />
    <link rel="stylesheet" href="css/lib_bootstrap3-wysihtml5-bower_bootstrap3-wysihtml5.css">
    <link rel="stylesheet" href="css/lib_fontawesome_css_font-awesome.css">
    <link rel="stylesheet" href="css/lib_Hover_hover.css">
    <link rel="stylesheet" href="css/lib_ionicons_css_ionicons.css">
    <link rel="stylesheet" href="css/lib_jquery.gritter_jquery.gritter.css">
    <link rel="stylesheet" href="css/lib_jquery.steps_jquery.steps.css">
    <link rel="stylesheet" href="css/lib_jquery-toggles_toggles-full.css">
    <link rel="stylesheet" href="css/lib_morrisjs_morris.css">
    <link rel="stylesheet" href="css/lib_select2_select2.css">
    <link rel="stylesheet" href="css/lib_weather-icons_css_weather-icons.css">
    <link rel="stylesheet" href="css/css_quirk.css"  >
    <link rel="stylesheet" href="font/droidserif.css">
    <link rel="stylesheet" href="font/colorbox.css">
    <link rel="stylesheet" href="font/bootstrap-responsive.css">
    <link rel="stylesheet" href="font/animate.delay.css">
    <link rel="stylesheet" href="font/roboto.css">
    <link rel="stylesheet" href="font/isotope.css">
    <link rel="stylesheet" href="css/lib_bootstrapcolorpicker_css_bootstrap-colorpicker.css">
    <link rel="stylesheet" href="css/lib_datatables-plugins_integration_bootstrap_3_dataTables.bootstrap.css">
    <link rel="stylesheet" href="css/lib_dropzone_dropzone.css">
    <link rel="stylesheet" href="css/lib_jquery-ui_jquery-ui.css">
    <link rel="stylesheet" href="css/lib_timepicker_jquery.timepicker.css">
    <link rel="stylesheet" href="css/site.css">
    <link rel="stylesheet" href="css/basic.css">

    <script src="scripts/modernizr-2.8.3.js"></script>
    <style>
        #imgGetContacts {
            width: 200px;
            height: 200px;
        }

        #imgAvatarTop {
            width: 24px;
            height: 24px;
        }

        #imgAvatarLeft {
            width: 48px;
            height: 48px;

        }

        #imgAvatarMe {
            width: 128px;
            height: 128px;

        }
    </style>
</head>
<body>
    <header>
        <div class="headerpanel">
        <!-- ################## MENU TOP ################## -->

<div class="logopanel">
    <h2><a href="Board.html">Edu.Class</a></h2>

</div><!-- logopanel -->

<div class="headerbar">

    <a id="menuToggle" class="menutoggle"><i class="fa fa-bars"></i></a>

    <div class="searchpanel">
        <div class="input-group">
                
                      


        </div><!-- input-group -->


    </div>
    
    <div class="header-right">

        <ul class="headermenu">
            
            <li>
                <div class="btn-group">
                    <button id="btnNombreCompleto" type="button" class="btn btn-logged" data-toggle="dropdown">
                
                    <img id="imgAvatarTop" src="" alt="" />
                        
                    NombreUsuario
                        <span class="caret"></span>
                    </button>
                    <ul class="dropdown-menu pull-right">
                        <li><a href="UserEdit.html"><i class="glyphicon glyphicon-cog"></i> Preferencias de Cuenta</a></li>
                        <li><a href="#" id="linkSignOut"><i class="glyphicon glyphicon-log-out"></i> Cerrar Sesión</a></li>
                    </ul>
                </div>
            </li>
        </ul>

    </div><!-- header-right -->
</div><!-- headerbar -->

    <script src="scripts/jquery-2.1.4.js"></script>
    <script src="scripts/jquery.validate.js"></script>
    <script src="scripts/jquery.validate.unobtrusive.js"></script>
    <script src="scripts/jquery.validate.unobtrusive.min.js"></script>
    <script src="scripts/jquery.validate-vsdoc.js"></script>
    <script src="scripts/jquery.validate.min.js"></script>
    <script src="scripts/js_quirk.js"></script>
    <script src="scripts/lib_select2_select2.js"></script>
    <script src="scripts/lib_bootstrap3-wysihtml5-bower_bootstrap3-wysihtml5.all.js"></script>
    <script src="scripts/lib_jquery-ui_jquery-ui.js"></script>
    <script src="scripts/lib_jquery-toggles_toggles.js"></script>
    <script src="scripts/lib_bootstrap_js_bootstrap.js"></script>
    <script src="scripts/lib_morrisjs_morris.js"></script>
    <script src="scripts/lib_raphael_raphael.js"></script>
    <script src="scripts/lib_flot_jquery.flot.js"></script>
    <script src="scripts/lib_flot_jquery.flot.resize.js"></script>
    <script src="scripts/lib_jquery.steps_jquery.steps.js"></script>
    <script src="scripts/lib_flot-spline_jquery.flot.spline.js"></script>
    <script src="scripts/lib_jquery-knob_jquery.knob.js"></script>
    <script src="scripts/lib_jquery.gritter_jquery.gritter.js"></script>
    <script src="scripts/lib_wysihtml5x_wysihtml5x-toolbar.js"></script>
    <script src="scripts/lib_wysihtml5x_wysihtml5x.js"></script>
    <script src="scripts/lib_timepicker_jquery.timepicker.js"></script>
    <script src="scripts/js.cookie.js"></script>
    <script src="scripts/initEduClass.js"></script>
    <script src="scripts/helpersSiteAndroid.js"></script>
    <script type="text/javascript" src="cordova.js"></script>
    <script type="text/javascript" src="js/index.js"></script>

            
        </div><!-- header-->
    </header>

    <section>

        <div class="leftpanel">
            <div class="leftpanelinner">

                <!-- ################## LEFT PANEL PROFILE ################## -->

                <div class="media leftpanel-profile">
                    <div class="media-left">
                        <a href="#">
                       
                            <img id="imgAvatarLeft" src="" alt="" class="media-object img-circle">
                       
                        </a>
                    </div>
                    <div class="media-body">
                        <h4 class="media-heading" id="headingNombreCompleto">nombreUsuario<a data-toggle="collapse" data-target="#loguserinfo" class="pull-right"><i class="fa fa-angle-down"></i></a>  </h4>
                        <span id="spanTipoPerson">tipoPersona</span>
                        

                    </div>
                </div><!-- leftpanel-profile -->

                <div class="leftpanel-userinfo collapse" id="loguserinfo">
                    <h5 class="sidebar-title">Contacto</h5>
                    <ul class="list-group">
                        <li class="list-group-item">
                            <label class="pull-left">Email</label>
                            <span class="pull-right" id="spanEmail">emailUsuario</span>
                        </li>
                        <li class="list-group-item">
                            <label class="pull-left">Cumpleaños</label>
                            <span class="pull-right" id="spanCumple">01/01/1990</span>
                        </li>
                        <li class="list-group-item">
                            <label class="pull-left">Cédula</label>
                            <span class="pull-right" id="spanCi">123456</span>
                        </li>
                    </ul>
                </div><!-- leftpanel-userinfo -->

                <div class="tab-content">

                    <!-- ################# MAIN MENU VERTICAL################### -->
                    
                    <div class="tab-pane active" id="mainmenu">
                        <h5 class="sidebar-title">Menú Principal</h5>
                        <ul class="nav nav-pills nav-stacked nav-quirk">
                            <li><a href="Board.html"><i class="fa fa-home"></i> <span>Dashboard</span></a></li>
                            <li><a href="#" id="linkGrupos"><i class="fa fa-users"></i> <span>Grupos</span></a></li>
                            <li class="nav-parent" >
                               <a href=""><i class="fa fa-list-alt"></i> <span>Mis Grupos</span></a>
                                <ul class="children" id="gruposDDLVertical">
                                         
                                </ul>
                            </li>
                        </ul>

                       
                        
                    </div><!-- tab-pane -->
                </div><!-- tab-content -->

            </div><!-- leftpanelinner -->
        </div><!-- leftpanel -->

        <div class="mainpanel">

            <div class="contentpanel">
                <!-- ################# INICIA CUERPO PRINCIPAL ################### -->

               <div class="panel panel-site-traffic col-md-8 col-md-offset-2">
    <div class="panel-heading">
        <h4 class="panel-title text-success">Editar Usuario</h4>
        
    </div>
    <div class="panel-body">
          <div class="form-horizontal">
                
                <input data-val="true" data-val-number="The field Id must be a number." data-val-required="El campo Id es obligatorio." id="IdPerson" name="IdPerson" type="hidden" value="2">

                <div class="form-group">
                    <label class="control-label col-md-2" for="UserName">Nombre Usuario</label>
                    <div class="col-md-10">
                        <input class="form-control text-box single-line" data-val="true" data-val-maxlength="El campo Nombre Usuario debe ser un tipo de cadena o matriz con una longitud máxima de '75'." data-val-maxlength-max="75" data-val-required="El campo Nombre Usuario es obligatorio." id="UserName" name="UserName" readonly="" type="text" value="">
                        <span class="field-validation-valid text-danger" data-valmsg-for="UserName" data-valmsg-replace="true"></span>
                    </div>
                </div>
                <div class="form-group">
                    <label class="control-label col-md-2" for="FirstName">Nombre</label>
                    <div class="col-md-10">
                        <input class="form-control text-box single-line" data-val="true" data-val-maxlength="El campo Nombre debe ser un tipo de cadena o matriz con una longitud máxima de '75'." data-val-maxlength-max="75" data-val-required="El campo Nombre es obligatorio." id="FirstName" name="FirstName" type="text" value="">
                        <span class="field-validation-valid text-danger" data-valmsg-for="FirstName" data-valmsg-replace="true"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-md-2" for="LastName">Apellido</label>
                    <div class="col-md-10">
                        <input class="form-control text-box single-line" data-val="true" data-val-maxlength="El campo Apellido debe ser un tipo de cadena o matriz con una longitud máxima de '75'." data-val-maxlength-max="75" data-val-required="El campo Apellido es obligatorio." id="LastName" name="LastName" type="text" value="">
                        <span class="field-validation-valid text-danger" data-valmsg-for="LastName" data-valmsg-replace="true"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-md-2" for="Birthday">Fecha Nacimiento</label>
                   <div class="col-md-10 input-group">
                        <!--<input class="form-control text-box single-line" id="datepicker" name="Birthday" placeholder="dd/mm/yyyy" type="text"> -->
                        <input id="datepicker" name="birthday" type="date" class="form-control">
                        <span class="input-group-addon"><i class="glyphicon glyphicon-calendar"></i></span>
                        <span class="field-validation-valid text-danger" data-valmsg-for="Birthday" data-valmsg-replace="true"></span>
                        
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-md-2" for="Email">Email</label>
                    <div class="col-md-10">
                        <input class="form-control text-box single-line" data-val="true" data-val-required="El campo Email es obligatorio." id="Email" name="Email" type="email" value="">
                        <span class="field-validation-valid text-danger" data-valmsg-for="Email" data-valmsg-replace="true"></span>
                    </div>
                </div>

                <div class="form-group">
                    <label class="control-label col-md-2" for="IdentificationCard">Cédula</label>
                    <div class="col-md-10">
                        <input class="form-control text-box single-line" data-val="true" data-val-required="El campo Cédula es obligatorio." id="IdentificationCard" name="IdentificationCard" type="text" value="">
                        <span class="field-validation-valid text-danger" data-valmsg-for="IdentificationCard" data-valmsg-replace="true"></span>
                    </div>
                </div>
                <div class="form-group">
                    <div class="row">
                        <div class="col-md-4 col-md-offset-2">
                            <a href="ChangePassword.html" class="btn-quirk pull-right"><i class="fa fa-key fa-2x"></i> Cambiar Contraseña</a>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <div class="col-md-offset-2 col-md-10">
                        <input type="button" id="btnGuardar" value="Guardar" class="btn btn-primary pull-right">
                        <a href="Board.html" class="btn btn-default-active pull-right mr10">Volver</a>
                    </div>
                </div>
            </div>     
        </div>
    </div>

            <!-- ################# FIN CUERPO PRINCIPAL ################### -->
            </div><!-- contentpanel -->
        </div><!-- mainpanel -->
    </section>

   

    <script>
        $(document).ready(function () {
            
            //################### ESTO VA SIEMPRE EN TODOS LOS HTML ########################
            var usuarioLogeado = Cookies.get('EduClassApiCookieUser'); // => 'value'
            var usu = jQuery.parseJSON(usuarioLogeado);
            
            $("#headingNombreCompleto").html(usu.nombre +" "+usu.apellido);
            $("#spanTipoPerson").html(usu.tipoUsuario);
            $("#spanEmail").html(usu.email);
            $("#spanCumple").html(usu.cumpleanios);
            $("#spanCi").html(usu.identificacion);
            if(usu.tipoUsuario == "Estudiante")
            {
                $('#linkGrupos').attr('href', 'JoinGroup.html');
            }

            var imgUrl = "";
            if(usu.urlPhoto)
            {
                imgUrl = usu.urlPhoto.replace(/[\\]/g,'/');
            }
            imgUrl = imgUrl.replace("~","");
            imgUrl = serverPathWeb() + imgUrl; 
            $("#imgAvatarLeft").attr("src",imgUrl);
            $("#btnNombreCompleto").html('<img id="imgAvatarTop" src="'+imgUrl+'" alt="" />' + usu.nombre + '<span class="caret"></span>');
            var grupoActual = Cookies.get("EduClassApiCookieGroup");
            //var fileTransfer = new FileTransfer();
            if(grupoActual)
            {
                grupoActual = JSON.parse(grupoActual);
                $("#botonMenu:first-child").text(grupoActual.nombreGrupo);
                $("#botonMenu:first-child").val(grupoActual.nombreGrupo);
            }

            

            var dato = usu.idUsuario;
            var idGrupo = "";
            var grupos;
            var posts; 

             

            $('#linkSignOut').on("click",function(){
                Cookies.remove('EduClassApiCookieGroup');
                Cookies.remove('EduClassApiCookieUser');
                window.location.href = "SignIn.html";
              
            });

            $('body').on('click', '#botonRefresh', function (e) {
                location.reload();
            }); 

           //################### FIN DE ESTO VA SIEMPRE ########################
           $('#IdPerson').val(usu.idUsuario);
           $('#UserName').val(usu.usuario);
           $('#Email').val(usu.email);
           $('#FirstName').val(usu.nombre);
           $('#LastName').val(usu.apellido);
           $('#IdentificationCard').val(usu.identificacion);

           
           var fecha = new Date(usu.cumpleanios);
           var day = fecha.getDate();
           var monthIndex = fecha.getMonth() + 1 ;
           var year = fecha.getFullYear();
           if(monthIndex < 10)
           {
                monthIndex = "0"+monthIndex;
           }
           if(day < 10)
           {
                day = "0"+day;
           }
           var fechaFormateada = year+"-"+monthIndex+ "-"+day;
           
           
           $('#datepicker').val(fechaFormateada);


           /*// Date Picker
            $('#datepicker').datepicker({
                dateFormat: "dd/mm/yy", changeMonth: true, changeYear: true, yearRange: "-100:+0",
                monthNames: ["Enero", "Febrero", "Marzo", "Abril", "Mayo", "Junio", "Julio", "Agosto", "Septiembre", "Octubre", "Noviembre", "Diciembre"],
                monthNamesShort: ["Ene", "Feb", "Mar", "Abr", "May", "Jun", "Jul", "Ago", "Sep", "Oct", "Nov", "Dic"],
                dayNamesMin: ["D", "L", "M", "M", "J", "V", "S"]
            });
            var queryDate = $('#datepicker').val(),
            dateParts = queryDate.match(/(\d+)/g)
            realDate = new Date(dateParts[0], dateParts[1] - 1, dateParts[2]); 
            $("#datepicker").datepicker("setDate", realDate);
            
            $('#datepicker-inline').datepicker();
            $('#datepicker-multiple').datepicker({ numberOfMonths: 2 });*/


           
            $('body').on('click', '#btnGuardar', function () {
    
                ActivityIndicator.show("Guardando...");
                var Idusu = $('#IdPerson').val();
                var username = $('#UserName').val();
                var email = $('#Email').val();
                var firstname = $('#FirstName').val();
                var lastname = $('#LastName').val();
                //var birthday = $('#datepicker').datepicker("getDate");
                var birthday = $('#datepicker').val();
                var password = "123456";//PARA QUE NO JODA EL VIEWMODEL
                var identificationCard = $('#IdentificationCard').val();

                var person= JSON.stringify({Id:Idusu,UserName: username, Password :  password, ConfirmPassword : password,Email:email, FirstName: firstname, LastName: lastname , Birthday: birthday , IdentificationCard: identificationCard });

                //var person= JSON.stringify({ PersonType: personType, UserName: username, Password: password, ConfirmPassword: confirmpassword,Email:email, FirstName: firstname, LastName: lastname , Birthday: birthday , IdentificationCard: identificationCard });   

                $.ajax({                                    
                        url: serverPath()+"/Users/Edit/",
                        type: "POST",
                        dataType: "json",
                        data: person,
                        success: function (result) {

                            if(result.error)//si esta definido
                            {
                                ActivityIndicator.hide();
                                showMessageJS(result.error);
                                
                            }
                            
                            if(result.mensaje)
                            {
                                ActivityIndicator.hide();
                                showMessageJS(result.mensaje);

                                var usuariologeado = JSON.stringify({ idUsuario: result.idUsuario, usuario: result.usuario, nombre: result.nombre, apellido: result.apellido, cumpleanios: result.cumpleanios, tipoUsuario: result.tipoUsuario, email: result.email, identificacion: result.identificacion, urlPhoto:result.urlPhoto }); 
                                Cookies.set("EduClassApiCookieUser", usuariologeado);
                                
                                window.location.href = result.url;

                                
                            }

                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                    ActivityIndicator.hide();
                    if (XMLHttpRequest.readyState == 4) {
                        // HTTP error (can be checked by XMLHttpRequest.status and XMLHttpRequest.statusText)
                        showMessageJS(XMLHttpRequest.statusText);
                    }
                    else if (XMLHttpRequest.readyState == 0) {
                        showMessageJS('Error al conectar con el servidor remoto');
                    }
                    else {
                        showMessageJS(errorThrown);
                    }
                },
                    contentType: 'application/json; charset=utf-8'
                
    
                });
            });

            $('body').on('click', '#gruposDDLVertical li a', function () {

                
                 idGrupo = $(this).attr('id');
                 $.ajax({
                    url: serverPath()+"/Groups/ChangeGroup/",
                    type: 'POST',
                    data: {usuario : dato, grupo: idGrupo},
                    success: function(result) {
                        if(result.error)//si esta definido
                                showMessageJS(result.error);
                        else
                        {
                            grupoActual = JSON.stringify({ idGrupo: result.idGrupo, nombreGrupo: result.nombreGrupo,descripcion : result.descripcion, claveGrupo: result.claveGrupo, estado : result.estado }); 
                            Cookies.set("EduClassApiCookieGroup", grupoActual);
                            location.reload();//Recarga la pagina entera
                            //$("#botonMenu:first-child").text(grupoActual.nombreGrupo);
                            //$("#botonMenu:first-child").val(grupoActual.nombreGrupo);
                        }

                        
                       
                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                    if (XMLHttpRequest.readyState == 4) {
                        // HTTP error (can be checked by XMLHttpRequest.status and XMLHttpRequest.statusText)
                        showMessageJS(XMLHttpRequest.statusText);
                    }
                    else if (XMLHttpRequest.readyState == 0) {
                        showMessageJS('Error al conectar con el servidor remoto');
                    }
                    else {
                        showMessageJS(errorThrown);
                    }
                }
                });
            });

            
            
             $.ajax({
                    type: 'GET',
                    url: serverPath()+"/Groups/GetGroups",
                    data: { 
                            id: dato
                          },
                    success:function(data){
                        
                        grupos=JSON.parse(data);
                        $.each(grupos, function(key, val) {

                        if(!grupoActual)
                        {
                            grupoActual = JSON.stringify({ idGrupo: val.idGrupo, nombreGrupo: val.Name,descripcion : val.Description, claveGrupo: val.Key, estado : val.Enabled}); 
                            Cookies.set("EduClassApiCookieGroup", grupoActual);
                        }

                        $("#gruposDDLVertical").append('<li><a href="#" id="'+ val.Id  +'">'+ val.Name +'</a></li>');
                        

                        });


                    },
                    error: function(XMLHttpRequest, textStatus, errorThrown) {
                    if (XMLHttpRequest.readyState == 4) {
                        // HTTP error (can be checked by XMLHttpRequest.status and XMLHttpRequest.statusText)
                        showMessageJS(XMLHttpRequest.statusText);
                    }
                    else if (XMLHttpRequest.readyState == 0) {
                        showMessageJS('Error al conectar con el servidor remoto');
                    }
                    else {
                        showMessageJS(errorThrown);
                    }
                }
                });
            
        });
</script>

</body>
</html>